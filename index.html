<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>AI 穿搭建議</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f5f5f7;
      --card-bg: #ffffff;
      --primary: #222;
      --accent: #ff6b6b;
      --muted: #777;
      --border-radius-lg: 18px;
      --border-radius-sm: 10px;
      --shadow-soft: 0 10px 30px rgba(0,0,0,0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Noto Sans TC", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #ffecec 0, #f5f5f7 45%, #f5f5f7 100%);
      color: var(--primary);
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      gap: 12px;
    }

    .logo {
      font-weight: 700;
      font-size: 22px;
      letter-spacing: 0.05em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-pill {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ff6b6b, #ff9f43);
      box-shadow: 0 6px 15px rgba(255,107,107,0.5);
    }

    .subtitle {
      font-size: 13px;
      color: var(--muted);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 20px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 20px;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
      gap: 10px;
    }

    .card-title {
      font-size: 17px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f3f3f8;
      color: var(--muted);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px 14px;
      margin-bottom: 16px;
    }

    @media (max-width: 600px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
    }

    label {
      font-weight: 500;
    }

    .hint {
      font-size: 11px;
      color: var(--muted);
    }

    select,
    input[type="number"] {
      padding: 8px 10px;
      border-radius: var(--border-radius-sm);
      border: 1px solid #e0e0ea;
      background: #fafafa;
      font-size: 14px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    select:focus,
    input[type="number"]:focus {
      border-color: #ff8a8a;
      box-shadow: 0 0 0 2px rgba(255,138,138,0.35);
      background: #ffffff;
    }

    .range-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    input[type="range"] {
      flex: 1;
    }

    .temp-display {
      min-width: 46px;
      text-align: right;
      font-size: 13px;
      color: var(--muted);
    }

    .primary-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 9px 16px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ff6b6b, #ff9f43);
      color: #fff;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(255,107,107,0.5);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
    }

    .primary-btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(255,107,107,0.6);
      opacity: 0.95;
    }

    .primary-btn[disabled] {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    .btn-row {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 4px;
    }

    .status-text {
      font-size: 11px;
      color: var(--muted);
    }

    .status-text.loading::before {
      content: "⏳ ";
    }
    .status-text.done::before {
      content: "✨ ";
    }
    .status-text.error::before {
      content: "⚠️ ";
    }

    /* Result side */

    .result-layout {
      display: grid;
      grid-template-rows: auto auto;
      gap: 14px;
      height: 100%;
    }

    .image-wrapper {
      border-radius: var(--border-radius-lg);
      background: linear-gradient(125deg, #fff7f7, #f9fbff);
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      height: 260px;
    }

    .image-inner {
      flex: 1;
      border-radius: 16px;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 1px solid #f0f0f5;
    }

    #outfit-image {
      max-width: 100%;
      max-height: 100%;
      display: block;
      object-fit: contain;
    }

    .image-placeholder {
      text-align: center;
      font-size: 13px;
      color: var(--muted);
      padding: 12px;
    }

    .desc {
      font-size: 13px;
      color: var(--muted);
    }

    .product-list {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 220px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .product-item {
      display: grid;
      grid-template-columns: 64px minmax(0, 1fr);
      gap: 10px;
      background: #fafafa;
      border-radius: 13px;
      padding: 8px;
      align-items: center;
    }

    .product-thumb {
      width: 64px;
      height: 64px;
      border-radius: 10px;
      background: #fff;
      border: 1px solid #eee;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: var(--muted);
    }

    .product-thumb img {
      max-width: 100%;
      max-height: 100%;
      object-fit: cover;
    }

    .product-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .product-name {
      font-size: 13px;
      font-weight: 500;
    }

    .product-meta {
      font-size: 11px;
      color: var(--muted);
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .product-price {
      font-size: 12px;
      font-weight: 600;
    }

    .product-link {
      font-size: 11px;
      color: #ff7b7b;
      text-decoration: none;
    }

    .product-link:hover {
      text-decoration: underline;
    }

    footer {
      margin-top: 22px;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div>
        <div class="logo">
          <span class="logo-pill"></span>
          <span>Outfit Studio</span>
        </div>
        <div class="subtitle">輸入條件 → 產生 AI 穿搭示意圖 + 類似商品清單</div>
      </div>
    </header>

    <main class="layout">
      <!-- 左側：條件輸入 -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">穿搭條件</div>
          <div class="pill">Step 1 · 設定條件</div>
        </div>

        <form id="outfit-form" onsubmit="event.preventDefault(); generateOutfit();">
          <div class="form-grid">
            <div class="form-field">
              <label for="gender">性別</label>
              <select id="gender" required>
                <option value="female">女性</option>
                <option value="male">男性</option>
                <option value="neutral">中性 / 不拘</option>
              </select>
              <div class="hint">會影響版型與剪裁感覺</div>
            </div>

            <div class="form-field">
              <label for="age">年齡</label>
              <input
                type="number"
                id="age"
                min="10"
                max="80"
                value="25"
                required
              />
              <div class="hint">可粗分風格成熟度</div>
            </div>

            <div class="form-field">
              <label for="style">風格</label>
              <select id="style" required>
                <option value="casual">休閒日常</option>
                <option value="minimal">極簡通勤</option>
                <option value="street">街頭風</option>
                <option value="sporty">運動風</option>
                <option value="smart">Smart Casual</option>
              </select>
            </div>

            <div class="form-field">
              <label for="temp-range">溫度</label>
              <div class="range-wrapper">
                <input
                  type="range"
                  id="temp-range"
                  min="5"
                  max="35"
                  value="22"
                  oninput="updateTempDisplay(this.value)"
                />
                <div class="temp-display">
                  <span id="temp-text">22</span>°C
                </div>
              </div>
              <div class="hint">之後會影響薄外套／厚外套等選擇</div>
            </div>
          </div>

          <div class="btn-row">
            <span id="status" class="status-text">準備好時，按下產生穿搭</span>
            <button type="submit" id="generate-btn" class="primary-btn">
              <span>✨ 產生穿搭示意圖</span>
            </button>
          </div>
        </form>
      </section>

      <!-- 右側：結果展示 -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">AI 穿搭示意圖 & 類似商品</div>
          <div class="pill">Step 2 · 結果預覽</div>
        </div>

        <div class="result-layout">
          <!-- 圖片區 -->
          <div class="image-wrapper">
            <div class="image-inner">
              <img
                id="outfit-image"
                src=""
                alt="Outfit preview"
                style="display:none;"
              />
              <div id="image-placeholder" class="image-placeholder">
                目前還沒有示意圖，請先在左邊輸入條件並產生一次穿搭。<br />
                下一步我們會把這裡接上 Google Gemini 的真正 AI 圖片。
              </div>
            </div>
            <div class="desc" id="outfit-desc">
              這裡會顯示以文字描述的穿搭說明，例如：
              「22°C 的晴天，建議你穿著白色寬版上衣搭配淺色直筒褲與帆布鞋，整體是偏向 UNIQLO 風格的極簡休閒感。」
            </div>
          </div>

          <!-- 商品清單區 -->
          <div>
            <div class="desc" style="margin-bottom:6px;">類似商品（示意）：</div>
            <div id="product-list" class="product-list">
              <!-- JS 會把商品卡片插入到這裡 -->
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      v0.1 · 前端 UI Demo — 之後會接上 AI 圖片生成 & 真實商品資料
    </footer>
  </div>

  <script>
  // ===== 工具：更新溫度顯示 =====
  function updateTempDisplay(v) {
    document.getElementById("temp-text").textContent = v;
  }

  // ===== 商品資料：UNIQLO 風格的示意商品 =====
  const products = [
    {
      id: "f-top-casual-01",
      name: "女裝 寬版圓領 T 恤（白）",
      brand: "UNIQLO 風格",
      type: "top",
      gender: "female",
      styles: ["casual", "minimal"],
      tempMin: 18,
      tempMax: 30,
      price: 390,
      currency: "TWD",
      thumb: "",
      link: "#"
    },
    {
      id: "f-bottom-casual-01",
      name: "女裝 直筒牛仔褲（淺藍）",
      brand: "UNIQLO 風格",
      type: "bottom",
      gender: "female",
      styles: ["casual", "minimal"],
      tempMin: 15,
      tempMax: 28,
      price: 990,
      currency: "TWD",
      thumb: "",
      link: "#"
    },
    {
      id: "u-top-minimal-01",
      name: "男女皆可 極簡落肩 T 恤（灰）",
      brand: "UNIQLO 風格",
      type: "top",
      gender: "unisex",
      styles: ["minimal", "smart"],
      tempMin: 16,
      tempMax: 28,
      price: 490,
      currency: "TWD",
      thumb: "",
      link: "#"
    },
    {
      id: "m-top-casual-01",
      name: "男裝 U 圓領寬版 T 恤（黑）",
      brand: "UNIQLO 風格",
      type: "top",
      gender: "male",
      styles: ["casual", "street"],
      tempMin: 20,
      tempMax: 32,
      price: 390,
      currency: "TWD",
      thumb: "",
      link: "#"
    },
    {
      id: "m-bottom-casual-01",
      name: "男裝 錐形長褲（卡其）",
      brand: "UNIQLO 風格",
      type: "bottom",
      gender: "male",
      styles: ["casual", "smart"],
      tempMin: 15,
      tempMax: 26,
      price: 1290,
      currency: "TWD",
      thumb: "",
      link: "#"
    },
    {
      id: "unisex-outer-01",
      name: "超輕羽絨外套（深藍）",
      brand: "UNIQLO 風格",
      type: "outer",
      gender: "unisex",
      styles: ["casual", "minimal", "smart"],
      tempMin: 8,
      tempMax: 18,
      price: 1990,
      currency: "TWD",
      thumb: "",
      link: "#"
    },
    {
      id: "accessory-bag-01",
      name: "尼龍迷你肩背包（黑）",
      brand: "UNIQLO 風格",
      type: "accessory",
      gender: "unisex",
      styles: ["casual", "street", "minimal"],
      tempMin: 5,
      tempMax: 35,
      price: 590,
      currency: "TWD",
      thumb: "",
      link: "#"
    }
  ];

  // ===== 挑商品：依性別 / 風格 / 溫度 =====
  function pickProducts(gender, style, temp) {
    let candidates = products.filter(p => {
      const genderMatch = p.gender === "unisex" || p.gender === gender;
      const styleMatch = p.styles.includes(style);
      const tempMatch = temp >= p.tempMin && temp <= p.tempMax;
      return genderMatch && styleMatch && tempMatch;
    });

    if (candidates.length === 0) {
      candidates = products.filter(p => {
        const genderMatch = p.gender === "unisex" || p.gender === gender;
        const styleMatch = p.styles.includes(style);
        return genderMatch && styleMatch;
      });
    }

    if (candidates.length === 0) {
      candidates = products;
    }

    return candidates.slice(0, 4);
  }

  // ===== 渲染商品卡片 =====
  function renderProducts(list) {
    const container = document.getElementById("product-list");
    container.innerHTML = "";

    list.forEach(p => {
      const el = document.createElement("div");
      el.className = "product-item";

      const thumbHTML = p.thumb
        ? `<img src="${p.thumb}" alt="${p.name}" />`
        : `<span>示意圖</span>`;

      el.innerHTML = `
        <div class="product-thumb">
          ${thumbHTML}
        </div>
        <div class="product-main">
          <div class="product-name">${p.name}</div>
          <div class="product-meta">
            <span>${p.brand}</span>
            <span>· ${p.type}</span>
          </div>
          <div class="product-price">
            $${p.price.toLocaleString()} ${p.currency}
          </div>
          <a class="product-link" href="${p.link}" target="_blank" rel="noopener noreferrer">
            前往查看類似商品
          </a>
        </div>
      `;

      container.appendChild(el);
    });
  }

  // 初始先用預設條件挑幾件商品
  renderProducts(pickProducts("female", "casual", 22));

  // ===== 真正呼叫後端產圖 =====
  async function generateOutfit() {
    const btn = document.getElementById("generate-btn");
    const status = document.getElementById("status");
    const gender = document.getElementById("gender").value;
    const age = parseInt(document.getElementById("age").value, 10);
    const style = document.getElementById("style").value;
    const temp = parseInt(document.getElementById("temp-range").value, 10);

    btn.disabled = true;
    status.textContent = "正在向後端 API 產生 AI 穿搭示意圖...";
    status.className = "status-text loading";

    try {
      console.log("呼叫 /api/generate-image...");
      const response = await fetch("/api/generate-image", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ gender, age, style, temp })
      });

      console.log("API status:", response.status);
      if (!response.ok) {
        const txt = await response.text();
        console.error("API error body:", txt);
        throw new Error("API 回應失敗：" + response.status);
      }

      const data = await response.json();
      console.log("API 回傳資料：", data);

      if (!data.image) {
        throw new Error("API 沒有回傳圖片資料");
      }

      // 文字描述
      const styleTextMap = {
        casual: "休閒日常",
        minimal: "極簡通勤",
        street: "街頭風",
        sporty: "運動風",
        smart: "Smart Casual"
      };

      const genderTextMap = {
        female: "女性",
        male: "男性",
        neutral: "中性風格"
      };

      const styleText = styleTextMap[style] || "日常穿搭";
      const genderText = genderTextMap[gender] || "不拘";

      const desc = `
${temp}°C 左右的天氣，適合${genderText}、約 ${age} 歲、偏向「${styleText}」的搭配。
以下示意圖是由 AI 依照日系極簡（類似 UNIQLO）的風格自動生成，主要提供整體輪廓與配色參考。
      `.trim();

      document.getElementById("outfit-desc").textContent = desc;

      // 顯示圖片
      const img = document.getElementById("outfit-image");
      const placeholder = document.getElementById("image-placeholder");

      img.src = "data:image/png;base64," + data.image;
      img.style.display = "block";
      if (placeholder) placeholder.style.display = "none";

      // 商品
      const selectedProducts = pickProducts(gender, style, temp);
      renderProducts(selectedProducts);

      status.textContent = "AI 穿搭示意圖已生成！";
      status.className = "status-text done";
    } catch (err) {
      console.error(err);
      status.textContent = "產生圖片時發生錯誤：" + err.message;
      status.className = "status-text error";
    } finally {
      btn.disabled = false;
    }
  }
</script>

</body>
</html>
