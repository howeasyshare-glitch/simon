<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>Body Test · AI 穿搭示意圖</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root{
  --bg:#f5f6f8; --card:#fff; --border:#e6e6ee;
  --text:#111; --muted:#666; --primary:#111;
  --ok:#0a7; --err:#c33;
}
body{
  margin:0; padding:24px;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background:var(--bg); color:var(--text);
}
h1{ margin:0 0 12px; }
.wrap{
  max-width:1100px; margin:0 auto;
  display:grid; gap:14px;
  grid-template-columns:380px 1fr;
}
@media(max-width:900px){ .wrap{grid-template-columns:1fr;} }
.card{
  background:var(--card); border:1px solid var(--border);
  border-radius:14px; padding:16px;
  box-shadow:0 10px 24px rgba(0,0,0,.06);
}
.row{display:flex;justify-content:space-between;align-items:center;gap:8px;}
.pill{font-size:12px;padding:4px 10px;border-radius:999px;background:#f1f2f6;color:var(--muted);}
label{font-size:13px;font-weight:700;display:block;margin-top:10px;}
input,select{
  width:100%;margin-top:6px;padding:8px 10px;
  border-radius:10px;border:1px solid var(--border);
}
button{
  margin-top:14px;width:100%;
  padding:10px;border-radius:10px;
  background:var(--primary);color:#fff;border:none;
}
button[disabled]{opacity:.5;cursor:not-allowed;}
.small{font-size:12px;color:var(--muted);}
.status{margin-top:8px;font-size:13px;}
.status.ok{color:var(--ok);}
.status.err{color:var(--err);}
.image-box{
  height:420px;border-radius:14px;
  border:1px solid var(--border);
  background:#f2f3f7;
  display:flex;align-items:center;justify-content:center;
  color:var(--muted);
}
.product-grid{
  display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:10px;margin-top:10px;
}
.product-card{
  border:1px solid var(--border);border-radius:10px;
  padding:8px;background:#fff;
}
pre{
  background:#0f1115;color:#d6e0ff;
  padding:12px;border-radius:10px;
  font-size:12px;overflow:auto;
}
</style>
</head>

<body>
<h1>AI 穿搭示意圖（產品模式）</h1>

<div class="wrap">

<!-- 左：輸入 -->
<div class="card">
  <div class="row">
    <strong>穿搭條件</strong>
    <span class="pill">扣 1 點 / 次</span>
  </div>

  <label>性別
    <select id="gender">
      <option value="female">女性</option>
      <option value="male">男性</option>
      <option value="neutral">中性</option>
    </select>
  </label>

  <label>年齡 <input id="age" type="number" value="25"/></label>
  <label>身高(cm) <input id="height" type="number" value="165"/></label>
  <label>體重(kg) <input id="weight" type="number" value="55"/></label>

  <label>風格
    <select id="style">
      <option value="casual">休閒</option>
      <option value="minimal">極簡</option>
      <option value="street">街頭</option>
      <option value="sporty">運動</option>
      <option value="smart">Smart Casual</option>
    </select>
  </label>

  <label>風格變體（品牌 / 名人）
    <select id="styleVariant">
      <option value="">無</option>
      <option value="brand-uniqlo">UNIQLO</option>
      <option value="brand-cos">COS</option>
      <option value="celeb-jennie-minimal">Jennie</option>
      <option value="celeb-gd-street">G-Dragon</option>
    </select>
  </label>

  <label>溫度(°C) <input id="temp" type="number" value="22"/></label>

  <label><input type="checkbox" id="withBag"/> 包包</label>
  <label><input type="checkbox" id="withHat"/> 帽子</label>
  <label><input type="checkbox" id="withCoat"/> 外套</label>

  <button id="btn" onclick="generate()">產生穿搭</button>
  <div id="status" class="status">請先登入再使用</div>
</div>

<!-- 右：結果 -->
<div class="card">
  <div class="row">
    <strong>AI 穿搭示意圖 & 類似商品</strong>
    <label class="small">
      <input type="checkbox" onchange="toggleDebug(this)"> Debug
    </label>
  </div>

  <!-- 圖片 -->
  <div style="margin-top:12px">
    <div class="pill">AI 穿搭示意圖</div>
    <div id="imageBox" class="image-box">
      尚未產生示意圖
    </div>
  </div>

  <!-- 商品 -->
  <div style="margin-top:16px">
    <div class="pill">類似商品</div>
    <div id="products" class="product-grid">
      <div class="small">尚未產生商品</div>
    </div>
  </div>

  <!-- Debug -->
  <div id="debug" style="display:none;margin-top:16px">
    <div class="pill">Outfit Spec（Debug）</div>
    <pre id="json">—</pre>
  </div>
</div>

</div>

<script>
function toggleDebug(el){
  document.getElementById("debug").style.display = el.checked ? "block":"none";
}

function renderImagePlaceholder(){
  document.getElementById("imageBox").innerHTML =
    `<div style="text-align:center">
      <div>（示意）AI 穿搭圖將顯示於此</div>
      <div class="small">下一步接 image API</div>
     </div>`;
}

function renderProducts(items){
  const box=document.getElementById("products");
  box.innerHTML="";
  items.forEach(it=>{
    const d=document.createElement("div");
    d.className="product-card";
    d.innerHTML=`
      <strong>${it.display_name_zh}</strong>
      <div class="small">${it.generic_name}</div>
      <div class="small">分類：${it.slot}</div>
      <div class="small">顏色：${it.color}</div>`;
    box.appendChild(d);
  });
}

async function generate(){
  const payload={
    gender:gender.value,
    age:+age.value,
    height:+height.value,
    weight:+weight.value,
    style:style.value,
    styleVariant:styleVariant.value,
    temp:+temp.value,
    withBag:withBag.checked,
    withHat:withHat.checked,
    withCoat:withCoat.checked
  };

  status.textContent="產生中…";
  renderImagePlaceholder();

  const r=await fetch("/api/generate-outfit-spec",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+localStorage.getItem("access_token")
    },
    body:JSON.stringify(payload)
  });

  const data=await r.json();
  json.textContent=JSON.stringify(data,null,2);

  renderProducts(data.items||[]);
  status.textContent=`完成，剩餘點數：${data.credits_left}`;
  status.className="status ok";
}
</script>
</body>
</html>
