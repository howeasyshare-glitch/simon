<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Body Shape Â· é›™éšæ®µèº«æï¼‹ç©¿æ­æ¸¬è©¦é </title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #f5f5f7;
      --card-bg: #ffffff;
      --primary: #222;
      --accent: #ff6b6b;
      --muted: #777;
      --border-radius-lg: 18px;
      --border-radius-sm: 10px;
      --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.08);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: "Noto Sans TC", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #ffecec 0, #f5f5f7 45%, #f5f5f7 100%);
      color: var(--primary);
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    header { margin-bottom: 20px; }

    .title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 22px;
      font-weight: 700;
    }

    .logo-pill {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: linear-gradient(135deg, #ff6b6b, #ff9f43);
      box-shadow: 0 6px 15px rgba(255, 107, 107, 0.5);
    }

    .subtitle {
      margin-top: 6px;
      font-size: 13px;
      color: var(--muted);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 20px;
    }

    @media (max-width: 840px) {
      .layout { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 20px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f3f3f8;
      color: var(--muted);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px 14px;
      margin-bottom: 14px;
    }

    @media (max-width: 600px) {
      .form-grid { grid-template-columns: 1fr; }
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
    }

    label { font-weight: 500; }

    .hint {
      font-size: 11px;
      color: var(--muted);
    }

    select,
    input[type="number"] {
      padding: 8px 10px;
      border-radius: var(--border-radius-sm);
      border: 1px solid #e0e0ea;
      background: #fafafa;
      font-size: 14px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    select:focus,
    input[type="number"]:focus {
      border-color: #ff8a8a;
      box-shadow: 0 0 0 2px rgba(255, 138, 138, 0.35);
      background: #ffffff;
    }

    .primary-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 9px 16px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ff6b6b, #ff9f43);
      color: #fff;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(255, 107, 107, 0.5);
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.1s ease;
    }

    .primary-btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(255, 107, 107, 0.6);
      opacity: 0.95;
    }

    .primary-btn[disabled] {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    .btn-row {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .status-text {
      font-size: 11px;
      color: var(--muted);
    }

    .status-text.loading::before { content: "â³ "; }
    .status-text.done::before    { content: "âœ¨ "; }
    .status-text.error::before   { content: "âš ï¸ "; }

    .image-wrapper {
      border-radius: var(--border-radius-lg);
      background: linear-gradient(125deg, #fff7f7, #f9fbff);
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      height: 420px;
    }

    .image-inner {
      flex: 1;
      border-radius: 16px;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border: 1px solid #f0f0f5;
      aspect-ratio: 3 / 4;
    }

    #result-image {
      max-width: 100%;
      max-height: 100%;
      display: block;
      object-fit: contain;
    }

    .image-placeholder {
      text-align: center;
      font-size: 13px;
      color: var(--muted);
      padding: 12px;
    }

    .desc {
      font-size: 13px;
      color: var(--muted);
    }

    footer {
      margin-top: 20px;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
    }

    .checkbox-row {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .checkbox-row label {
      font-weight: 400;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .checkbox-row input[type="checkbox"] {
      transform: scale(0.9);
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="title">
        <span class="logo-pill"></span>
        <span>Body Shape Test Â· èº«æç‰ˆæœ¬2025 v1ï¼‹é…ä»¶æ¸¬è©¦</span>
      </div>
      <div class="subtitle">
        å¾Œç«¯ä½¿ç”¨ã€Œèº«æç‰ˆæœ¬2025 v1ã€ï¼šå…ˆç”¢ç”Ÿè²¼èº«ç´ è‰²èº«æåŸºåº•åœ–ï¼Œå†åœ¨åŒä¸€å€‹èº«æä¸Šå¥— UNIQLO é¢¨æ ¼ç©¿æ­ã€‚é€™å€‹é é¢å°ˆé–€æ‹¿ä¾†æ¸¬è©¦åŒ…åŒ… / å¸½å­å‹¾é¸æ˜¯å¦çœŸçš„æœ‰ä½œç”¨ã€‚
      </div>
    </header>

    <main class="layout">
      <!-- å·¦å´ï¼šæ¢ä»¶è¼¸å…¥ -->
      <section class="card">
        <div class="card-title">
          æ¸¬è©¦æ¢ä»¶
          <span class="pill">Step 1 Â· è¨­å®šäººç‰©ã€èº«æèˆ‡é…ä»¶</span>
        </div>

        <form id="body-form" onsubmit="event.preventDefault(); generateOutfit();">
          <div class="form-grid">
            <div class="form-field">
              <label for="gender">æ€§åˆ¥</label>
              <select id="gender" required>
                <option value="female">å¥³æ€§</option>
                <option value="male">ç”·æ€§</option>
                <option value="neutral">ä¸­æ€§ / ä¸æ‹˜</option>
              </select>
              <div class="hint">åªå½±éŸ¿äººç‰©å½¢è±¡ï¼Œä¸é™åˆ¶è¡£æœæ¬¾å¼ã€‚</div>
            </div>

            <div class="form-field">
              <label for="age">å¹´é½¡</label>
              <input type="number" id="age" min="10" max="80" value="25" required />
              <div class="hint">ä¾‹å¦‚ï¼š18ã€25ã€35ã€45â€¦</div>
            </div>

            <div class="form-field">
              <label for="height">èº«é«˜ï¼ˆcmï¼‰</label>
              <input type="number" id="height" min="140" max="210" value="165" required />
              <div class="hint">å»ºè­°ä¸€æ¬¡å›ºå®šèº«é«˜ï¼Œåªæ”¹é«”é‡åšæ¯”è¼ƒã€‚</div>
            </div>

            <div class="form-field">
              <label for="weight">é«”é‡ï¼ˆkgï¼‰</label>
              <input type="number" id="weight" min="35" max="150" value="55" required />
              <div class="hint">å¯ä»¥æ¸¬è©¦ 45 / 60 / 80 / 100 kg çš„å·®ç•°ã€‚</div>
            </div>

            <div class="form-field">
              <label for="style">é¢¨æ ¼</label>
              <select id="style">
                <option value="casual">ä¼‘é–’æ—¥å¸¸</option>
                <option value="minimal">æ¥µç°¡é€šå‹¤</option>
                <option value="street">è¡—é ­é¢¨</option>
                <option value="sporty">é‹å‹•é¢¨</option>
                <option value="smart">Smart Casual</option>
              </select>
            </div>

            <div class="form-field">
              <label for="temp">æº«åº¦ï¼ˆÂ°Cï¼‰</label>
              <input type="number" id="temp" value="22" />
              <div class="hint">æœƒå½±éŸ¿è¡£æœåšåº¦ï¼Œèº«æä¸å—å½±éŸ¿ã€‚</div>
            </div>

            <div class="form-field">
              <label>èº«æé ä¼°ï¼ˆBMIï¼‰</label>
              <div id="bmi-info" class="hint">BMIï¼š--ï¼Œèº«å‹ï¼š--</div>
            </div>

            <div class="form-field">
              <label>é…ä»¶é¸æ“‡ï¼ˆé…åˆå¾Œç«¯ prompt æ¸¬è©¦ï¼‰</label>
              <div class="checkbox-row">
                <label>
                  <input type="checkbox" id="acc-bag" checked />
                  åŒ…åŒ…ï¼ˆå‹¾é¸æ™‚å¿…é ˆæœ‰åŒ…åŒ…ï¼›æ²’å‹¾æ™‚å¿…é ˆæ²’æœ‰åŒ…åŒ…ï¼‰
                </label>
                <label>
                  <input type="checkbox" id="acc-hat" />
                  å¸½å­ï¼ˆå‹¾é¸æ™‚å¿…é ˆå‡ºç¾å¸½å­ï¼›æ²’å‹¾æ™‚å¿…é ˆæ²’æœ‰å¸½å­ï¼‰
                </label>
              </div>
              <div class="hint">é€™è£¡åªæ§åˆ¶åŒ…åŒ…ï¼å¸½å­ï¼Œæ–¹ä¾¿ä½ çœ‹ã€Œé…ä»¶æŒ‡ä»¤æœ‰æ²’æœ‰è¢«æ¨¡å‹è½è©±ã€ã€‚</div>
            </div>
          </div>

          <div class="btn-row">
            <span id="status" class="status-text">è¨­å®šå¥½æ¢ä»¶å¾Œï¼ŒæŒ‰ä¸‹ã€Œç”¢ç”Ÿ AI ç©¿æ­ç¤ºæ„åœ–ã€ã€‚</span>
            <button type="submit" id="generate-btn" class="primary-btn">
              ğŸ§â€â™€ï¸ ç”¢ç”Ÿ AI ç©¿æ­ç¤ºæ„åœ–
            </button>
          </div>
        </form>
      </section>

      <!-- å³å´ï¼šçµæœ -->
      <section class="card">
        <div class="card-title">
          çµæœé è¦½
          <span class="pill">Step 2 Â· æŸ¥çœ‹èº«æï¼‹ç©¿æ­ï¼‹é…ä»¶</span>
        </div>

        <div class="image-wrapper">
          <div class="image-inner">
            <img id="result-image" src="" alt="Outfit preview" style="display:none;" />
            <div id="image-placeholder" class="image-placeholder">
              é‚„æ²’æœ‰çµæœã€‚<br />
              å¯ä»¥å…ˆå›ºå®šèº«é«˜ï¼Œä¾‹å¦‚ 165 cmï¼Œ<br />
              æ¥è‘—æ¸¬è©¦ï¼š
              <ul style="margin:6px 0 0 18px; padding:0; text-align:left; font-size:12px;">
                <li>åŒ…åŒ… âœ… / å¸½å­ âŒ</li>
                <li>åŒ…åŒ… âŒ / å¸½å­ âœ…</li>
                <li>åŒ…åŒ… âŒ / å¸½å­ âŒ</li>
              </ul>
              çœ‹çœ‹åœ–ä¸­çš„åŒ…åŒ… / å¸½å­æ˜¯å¦æœ‰è·Ÿå‹¾é¸åŒæ­¥ã€‚
            </div>
          </div>
          <div class="desc">
            å¾Œç«¯æœƒå…ˆç”¢ç”Ÿä¸€å¼µã€Œè²¼èº«ç´ è‰²è¡£æœçš„èº«æåŸºåº•åœ–ã€ï¼Œå†åœ¨åŒä¸€å€‹èº«æä¸Šå¥—å…¥ UNIQLO é¢¨æ ¼ç©¿æ­ã€‚é€™è£¡é¡¯ç¤ºçš„æ˜¯ç¬¬äºŒéšæ®µï¼ˆç©¿å¥½è¡£æœï¼‰çš„æˆæœã€‚
          </div>
        </div>
      </section>
    </main>

    <footer>
      Body Shape Debug Â· èº«æç‰ˆæœ¬2025 v1ï¼‹é…ä»¶æ¸¬è©¦ã€‚æƒ³èª¿æ•´ã€Œèƒ–ç˜¦ç¨‹åº¦ã€ï¼Œå¯ä»¥åœ¨å¾Œç«¯çš„ <code>getBodyShapePrompt()</code> ä¿®æ”¹æ–‡å­—æè¿°ã€‚
    </footer>
  </div>

  <script>
  async function searchSimilarProducts() {
    const resp = await fetch("/api/search-products", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ items })
    });
    const data = await resp.json();
    renderProductResults(data);
  }
</script>

  <script>
    function getBmiTag(height, weight) {
      const h = height / 100;
      const bmi = weight / (h * h);
      if (!isFinite(bmi)) return { bmi: null, label: "â€”" };

      if (bmi < 19) return { bmi, label: "åç˜¦ï¼ˆSlimï¼‰" };
      if (bmi < 25) return { bmi, label: "æ­£å¸¸ï¼ˆAverageï¼‰" };
      if (bmi < 30) return { bmi, label: "å¾®èƒ–ï¼ˆSlightly chubbyï¼‰" };
      return { bmi, label: "è±æ»¿ï¼ˆPlus-sizeï¼‰" };
    }

    function updateBmiDisplay() {
      const h = parseFloat(document.getElementById("height").value);
      const w = parseFloat(document.getElementById("weight").value);
      const el = document.getElementById("bmi-info");
      if (!h || !w) {
        el.textContent = "BMIï¼š--ï¼Œèº«å‹ï¼š--";
        return;
      }
      const { bmi, label } = getBmiTag(h, w);
      if (!bmi) {
        el.textContent = "BMIï¼š--ï¼Œèº«å‹ï¼š--";
        return;
      }
      el.textContent = `BMIï¼šç´„ ${bmi.toFixed(1)}ï¼Œèº«å‹æ¨ä¼°ï¼š${label}`;
    }

    document.getElementById("height").addEventListener("input", updateBmiDisplay);
    document.getElementById("weight").addEventListener("input", updateBmiDisplay);
    updateBmiDisplay();

    async function generateOutfit() {
      const gender = document.getElementById("gender").value;
      const age = parseInt(document.getElementById("age").value, 10);
      const style = document.getElementById("style").value;
      const temp = parseFloat(document.getElementById("temp").value);
      const height = parseFloat(document.getElementById("height").value);
      const weight = parseFloat(document.getElementById("weight").value);
      const withBag = document.getElementById("acc-bag").checked;
      const withHat = document.getElementById("acc-hat").checked;

      const status = document.getElementById("status");
      const btn = document.getElementById("generate-btn");
      const img = document.getElementById("result-image");
      const placeholder = document.getElementById("image-placeholder");

      if (!height || !weight || !age) {
        status.textContent = "è«‹å…ˆè¼¸å…¥å®Œæ•´çš„å¹´é½¡ã€èº«é«˜èˆ‡é«”é‡ã€‚";
        status.className = "status-text error";
        return;
      }

      status.textContent = "æ­£åœ¨ç”¢ç”Ÿ AI èº«æï¼‹ç©¿æ­ï¼‹é…ä»¶ç¤ºæ„åœ–ï¼ˆå¾Œç«¯æœƒè·‘é›™éšæ®µç”Ÿæˆï¼‰â€¦";
      status.className = "status-text loading";
      btn.disabled = true;

      try {
        const response = await fetch("/api/generate-image", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            gender,
            age,
            style,
            temp,
            height,
            weight,
            withBag,
            withHat
          })
        });

        const rawText = await response.text();
        let data;
        try {
          data = JSON.parse(rawText);
        } catch {
          throw new Error("API å›å‚³é JSONï¼š" + rawText.slice(0, 120));
        }

        if (!response.ok) {
          console.error("API error detail:", data);
          throw new Error("API å›æ‡‰å¤±æ•—ï¼š" + response.status + "ï¼" + (data.error || "unknown"));
        }

        if (!data.image) {
          throw new Error("API æ²’æœ‰å›å‚³åœ–ç‰‡è³‡æ–™");
        }

        img.src = "data:image/png;base64," + data.image;
        img.style.display = "block";
        placeholder.style.display = "none";

        status.textContent = "å·²å®Œæˆï¼Œè«‹æ”¹è®ŠåŒ…åŒ…ï¼å¸½å­å‹¾é¸ï¼Œçœ‹çœ‹åœ–ä¸­çš„é…ä»¶æœ‰æ²’æœ‰è·Ÿè‘—è®ŠåŒ–ã€‚";
        status.className = "status-text done";
      } catch (err) {
        console.error(err);
        status.textContent = "ç”¢ç”Ÿåœ–ç‰‡æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š" + err.message;
        status.className = "status-text error";
      } finally {
        btn.disabled = false;
      }
    }
  </script>
</body>
</html>
